<!DOCTYPE html>
<html>
  <head>
	  <script src="/pokemon/scripts/tasks.js">

let data_and_info;

async function initializeTable() {
    try {
        // Get the data URL - using the same logic as original
        const form = document.querySelector('form');
        if (!form) {
            console.error('Form not found');
            return;
        }

        // Use the same URL construction as original code
        form.action = getCookie('url') + '/update';
        const data_and_info_url = form.action.replace('update', 'user-info');

        console.log('Fetching from:', data_and_info_url);

        // Fetch data (same as original)
        const response = await fetch(data_and_info_url, {
            headers: {
                "heroku-skip-browser-warning": "true",
                "content-type": "application/json"
            },
            credentials: "include"
        });
        
        data_and_info = await response.json();
        
        // Check for redirect (same as original)
        if ('redirect' in data_and_info) {
            window.location.href = data_and_info['redirect'];
            return;
        }

        // Create table with the data
        createTable();

    } catch (error) {
        console.error('Error initializing table:', error);
        // Fallback like original code
        callMaster();
    }
}

function createTable() {
    try {
        // Same variable names as original code
        let info = data_and_info['info'];
        let data = data_and_info['data'];
        const table = document.querySelector("table");
        
        // Fix the selectors - these were incorrect in your original
        const thead = table.querySelector('thead');
        const tbody = table.querySelector('tbody');

        // Clear existing content
        thead.innerHTML = '';
        tbody.innerHTML = '';

        if (info.length > 0) {
            const keys = Object.keys(info[0]);
            const headerRow = document.createElement("tr");

            // Create header cells
            keys.forEach(key => {
                const th = document.createElement("th");
                th.textContent = key.charAt(0).toUpperCase() + key.slice(1);
                headerRow.appendChild(th);
            });

            thead.appendChild(headerRow);

            // Create data rows (first 3 items only - same as original)
            info.slice(0, 3).forEach(item => {
                const row = document.createElement("tr");

                keys.forEach(key => {
                    const td = document.createElement("td"); // Fixed: was 'ta' in your code
                    td.textContent = item[key];
                    row.appendChild(td); // Fixed: was 'a' in your code
                });

                tbody.appendChild(row);
            });
        }
    } catch (error) {
        console.error('Error creating table:', error);
    }
}

// Cookie function (same as your original likely had)
function getCookie(name) {
    const value = `; ${document.cookie}`;
    const parts = value.split(`; ${name}=`);
    if (parts.length === 2) return parts.pop().split(';').shift();
    return window.location.origin; // Fallback to current origin
}

// Fallback function (same as your original)
function callMaster(url) {
    if (url) {
        window.location.href = url;
    } else {
        window.location.href = '/'; // Or your fallback URL
    }
}
		  
	  </script>		
	   <link rel="icon" href="/Pokemon/media/favicon.png">
        <link rel="stylesheet" href="/Pokemon/styles/tasks.css">
  </head>
	<body>
		<div>
			<table>
				<thead></thead>
				<tbody></tbody>
			</table>
		</div>
  </body>
</html>
