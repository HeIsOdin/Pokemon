<!DOCTYPE html>
<html>
  <head>
	  <script>
		(function() {
	  		const isGithub = window.location.hostname.split(".")[1] === "github";
      		let base = "/";
      		if (isGithub) {
        		const pathParts = window.location.pathname.split("/");
        		if (pathParts.length > 1 && pathParts[1])  base = "/" + pathParts[1] + "/";
      		}
      		let baseEl = document.querySelector("base");
      		if (!baseEl) {
        		baseEl = document.createElement("base");
        		document.head.prepend(baseEl);
      		}
      		baseEl.setAttribute("href", base);
    	})();
  		</script>
	<link rel="icon" href="/Pokemon/media/favicon.png"/>
    <link rel="stylesheet" href="/Pokemon/styles/tasks.css">
  </head>
	
  <body>
    <h2>TASKS HISTORY:</h2><br>
	  <form>
  <div id="task-history-container">
						<table>
							<thead></thead>
							<tbody></tbody>
						</table>
					</div>
		  </form>
			<script>async function fetchDataAndRenderTable(data_and_info_url) {
    try {
        // Fetch JSON from your backend endpoint
        const response = await fetch(data_and_info_url, {
            headers: {
                "ngrok-skip-browser-warning": "true", // useful if using ngrok
                "Content-Type": "application/json"
            },
            credentials: "include" // keeps cookies/session if needed
        });

        if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
        }

        const data_and_info = await response.json();

        // Grab the "info" part (or use "data" if you prefer)
        let info = data_and_info['info'];
        // let data = data_and_info['data'];  // optional second dataset

        // Render the table
        renderTable(info);

    } catch (error) {
        console.error("Error fetching data:", error);
    }
}

function renderTable(data) {
    const table = document.querySelector("table");
    const thead = table.querySelector("thead");
    const tbody = table.querySelector("tbody");

    // Clear previous content
    thead.innerHTML = "";
    tbody.innerHTML = "";

    if (!Array.isArray(data) || data.length === 0) {
        console.warn("No data available to render.");
        return;
    }

    // Create headers from first object keys
    const keys = Object.keys(data[0]);
    const headerRow = document.createElement("tr");

    keys.forEach(key => {
        const th = document.createElement("th");
        th.textContent = key.charAt(0).toUpperCase() + key.slice(1);
        headerRow.appendChild(th);
    });

    thead.appendChild(headerRow);

    // Create rows
    data.forEach(item => {
        const row = document.createElement("tr");

        keys.forEach(key => {
            const td = document.createElement("td");
            td.textContent = item[key] ?? "";
            row.appendChild(td);
        });

        tbody.appendChild(row);
    });
}</script>		
  </body>
</html>
